<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<title>Population Visualization</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<link href='https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&display=swap' rel='stylesheet'>
<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js'></script>
<style>
body { font-family: 'IBM Plex Sans', sans-serif; margin:0; background:transparent; }
svg { width:100%; height:auto; background:transparent; }
.x-axis text { font-size:13px; }
.y-axis, .y-axis path, .y-axis .tick line, .y-axis .domain { display:none; }
.marker { fill:#fff; stroke:#196533; stroke-width:2px; }
.legend text { font-size:14px; }
.label-fw rect { fill:#196533; rx:4; ry:4; }
.label-fw text { fill:#fff; font-size:15px; font-weight:600; }
.label-sw { fill:#196533; font-size:15px; font-weight:700; }
.growth { fill:#196533; font-size:15px; font-weight:700; }
.ref-line { stroke:#196533; stroke-dasharray:5 4; stroke-width:1.5px; }
.tooltip { position:fixed; background:#fff; border:1px solid #ccc; padding:8px; border-radius:6px; font-size:13px; display:none; }
</style>
</head>
<body>
<div class='chart-wrap'>
<svg id='chart'></svg>
<div class='tooltip' id='tooltip'></div>
</div>
<script>
const url = 'https://adithyaajith-j.github.io/FDTMP_WebAPP/ChartData/FDTMP_Population_Statewide.csv';
const GREEN = '#196533';
const FW_WIDTH = 4, SW_WIDTH = 2;
const DASH = '5 4';
const markerYears = [2000,2010,2020,2024,2030,2040,2050];
const labelYears = [2000,2024,2050];
const projectionStart = 2024;
const svg = d3.select('#chart');
const tooltip = d3.select('#tooltip');
function formatMillions(n){return (n/1e6).toFixed(1)+'M';}
function formatPercent(p){return Math.round(p)+'%';}
function getValueAt(series,year){const i=d3.bisector(d=>d.year).left(series,year);if(i<series.length&&series[i].year===year)return series[i].value;const i1=Math.max(0,i-1),i2=Math.min(series.length-1,i);const a=series[i1],b=series[i2];if(!a||!b)return null;const t=(year-a.year)/(b.year-a.year);return a.value+t*(b.value-a.value);}
function render(data){svg.selectAll('*').remove();const width=900,height=500,margin={top:90,right:30,bottom:50,left:40};svg.attr('viewBox',`0 0 ${width} ${height}`);
const fwSeries=data.map(d=>({year:+d.Year,value:+d['Fort Worth']})).sort((a,b)=>a.year-b.year);
const swSeries=data.map(d=>({year:+d.Year,value:+d.Statewide})).sort((a,b)=>a.year-b.year);
const x=d3.scaleLinear().domain([2000,2050]).range([margin.left,width-margin.right]);
const y=d3.scaleLinear().domain(d3.extent([...fwSeries.map(d=>d.value),...swSeries.map(d=>d.value)])).nice().range([height-margin.bottom,margin.top]);
const xAxis=d3.axisBottom(x).tickValues(markerYears.filter(y => y !== 2024)).tickFormat(d3.format('d'));
svg.append('g').attr('class','x-axis').attr('transform',`translate(0,${height-margin.bottom})`).call(xAxis);

// 2024 reference line.
const valFW = getValueAt(fwSeries, 2024);
const valSW = getValueAt(swSeries, 2024);
const maxVal2024 = Math.max(valFW, valSW);
svg.append('line').attr('class', 'ref-line').attr('x1', x(2024)).attr('x2', x(2024)).attr('y1', y(maxVal2024)).attr('y2', height - margin.bottom);

const line=d3.line().x(d=>x(d.year)).y(d=>y(d.value)).curve(d3.curveMonotoneX);
function drawSeries(series,isFW){const solid=series.filter(d=>d.year<=projectionStart);const dotted=series.filter(d=>d.year>=projectionStart);svg.append('path').attr('fill','none').attr('stroke',GREEN).attr('stroke-width',isFW?FW_WIDTH:SW_WIDTH).attr('d',line(solid));svg.append('path').attr('fill','none').attr('stroke',GREEN).attr('stroke-width',isFW?FW_WIDTH:SW_WIDTH).attr('stroke-dasharray',DASH).attr('d',line(dotted));}
drawSeries(fwSeries,true);drawSeries(swSeries,false);
function drawMarkers(series){markerYears.forEach(yr=>{const val=getValueAt(series,yr);if(val!=null){svg.append('circle').attr('class','marker').attr('r',5).attr('cx',x(yr)).attr('cy',y(val));}});}
drawMarkers(fwSeries);drawMarkers(swSeries);
// Legend
const legend=svg.append('g').attr('transform',`translate(${margin.left+10},${margin.top-50})`);
legend.append('line').attr('x1',0).attr('x2',36).attr('y1',0).attr('y2',0).attr('stroke',GREEN).attr('stroke-width',FW_WIDTH);
legend.append('text').attr('x',44).attr('y',4).text('Fort Worth District Population');
legend.append('line').attr('x1',0).attr('x2',36).attr('y1',20).attr('y2',20).attr('stroke',GREEN).attr('stroke-width',SW_WIDTH);
legend.append('text').attr('x',44).attr('y',24).text('Statewide Population');
// Labels
function drawLabels(series,isFW){labelYears.forEach(yr=>{const val=getValueAt(series,yr);if(val!=null){const cx=x(yr),cy=y(val) - (isFW ? 18 : 14);if(isFW){const g=svg.append('g').attr('class','label-fw');const t=g.append('text').attr('x',cx).attr('y',cy).attr('text-anchor','middle').text(formatMillions(val));const bb=t.node().getBBox();g.insert('rect','text').attr('x',bb.x-8).attr('y',bb.y-5).attr('width',bb.width+16).attr('height',bb.height+10);}else{svg.append('text').attr('class','label-sw').attr('x',cx).attr('y',cy).attr('text-anchor','middle').text(formatMillions(val));}}});}
drawLabels(fwSeries,true);drawLabels(swSeries,false);
// Growth labels
function drawGrowth(series){const g1=(getValueAt(series,2024)-getValueAt(series,2000))/getValueAt(series,2000)*100;const g2=(getValueAt(series,2050)-getValueAt(series,2024))/getValueAt(series,2024)*100;const mid1=(2000+2024)/2,mid2=(2024+2050)/2;svg.append('text').attr('class','growth').attr('x',x(mid1)).attr('y',y(getValueAt(series,mid1))-22).attr('text-anchor','middle').text(formatPercent(g1));svg.append('text').attr('class','growth').attr('x',x(mid2)).attr('y',y(getValueAt(series,mid2))-22).attr('text-anchor','middle').text(formatPercent(g2));}
drawGrowth(fwSeries);drawGrowth(swSeries);
// Tooltip
svg.on('mousemove',function(event){const [mx]=d3.pointer(event);const year=Math.round(x.invert(mx));const nearest=markerYears.reduce((a,b)=>Math.abs(b-year)<Math.abs(a-year)?b:a);const fw=getValueAt(fwSeries,nearest),sw=getValueAt(swSeries,nearest);if(fw||sw){tooltip.style('display','block').style('left',(event.clientX+10)+'px').style('top',(event.clientY-10)+'px').html(`<strong>Year ${nearest}</strong><br>Statewide: ${formatMillions(sw)}<br>Fort Worth: ${formatMillions(fw)}`);}else{tooltip.style('display','none');}}).on('mouseleave',()=>tooltip.style('display','none'));
}
d3.csv(url).then(render);
</script>
</body>
</html>